---
title: "Logboek Medulloblastoma"
author: "Floris Menninga"
date: "`r Sys.Date()`"
output:
  html_document:
    toc: yes
    toc_depth: 2
  pdf_document:
    toc: yes
    toc_depth: '2'
  word_document:
    toc: yes
    toc_depth: '2'
---

```{r libraries, results='hold', message=FALSE, warning=FALSE}
# Libraries
library(tidyverse)
library(GenomicRanges)

```

## **Inleiding:** ##


## **FastQC analyse:**
Het paired read sample van patient: SRR26913194 is gebruikt. 
SRR26913194_1.fastq.gz en SRR26913194_2.fastq.gz zijn gebruikt als input voor FastQC.

Het resulataat van de fastQC voor het uitvoeren van de vervolgstappen: (trimmen etc.)

**SRR26913194_2:**

| Measure      | Value       |
|--------------|-------------|
| Filename     | SRR26913194_2_fastq_gz.gz  |
| File type    | Conventional base calls  |
| Encoding     | Sanger / Illumina 1.9   |
| Total Sequences| 21866605      |
| Sequences flagged as poor quality| 0    |
| Sequence length| 75         |
| %GC           | 48          |

**SRR26913194_1:**

| Measure      | Value       |
|--------------|-------------|
| Filename     | SRR26913194_1_fastq_gz.gz  |
| File type    | Conventional base calls  |
| Encoding     | Sanger / Illumina 1.9   |
| Total Sequences| 21866605      |
| Sequences flagged as poor quality| 0    |
| Sequence length| 75         |
| %GC           | 49          |


**Per base sequence quality van SRR26913194_1 voor het trimmen:**
![SRR26913194_1](`r getwd()`/Data/SRR26913194_1.png "Voor trimmen")

**Per base sequence quality van SRR26913194_2 voor het trimmen:**
![SRR26913194_1](`r getwd()`/Data/SRR26913194_2.png "Voor trimmen")

## **FastQ trimmen:**
Met behulp van Trimmomatic zijn de reads getrimmed. 
Het aantal reads in SRR26913194_1 

De onderstaande parameters zijn gebruikt voor het uitvoeren van Trimmomatic. 

| Input Parameter                             | Value                                                                 |
|---------------------------------------------|-----------------------------------------------------------------------|
| Single-end or paired-end reads?             | pair_of_files                                                         |
| Input FASTQ file (R1/first of pair)         | SRR26913194_1.fastq.gz                                                |
| Input FASTQ file (R2/second of pair)        | SRR26913194_2.fastq.gz                                                |
| Perform initial ILLUMINACLIP step?          | 1                                                                     |
| Select standard adapter sequences or custom?| standard                                                              |
| Adapter sequences to use                    | TruSeq3 (paired-ended, for MiSeq and HiSeq)                           |
| Maximum mismatch count                      | 2                                                                     |
| Accuracy of match between reads             | 30                                                                    |
| Minimum length of adapter                   | 8                                                                     |
| Always keep both reads?                     | 1                                                                     |
| Select Trimmomatic operation                | SLIDINGWINDOW                                                         |
| Number of bases to average across           | 4                                                                     |
| Average quality required                    | 20                                                                    |
| Select Trimmomatic operation                | MINLEN                                                                |
| Minimum length of reads to be kept          | 40                                                                    |



**Per base sequence quality van SRR26913194_1 na het trimmen:**
![SRR26913194_1](`r getwd()`/Data/SRR26913194_1_Trimmomatic.png "Voor trimmen")

**Per base sequence quality van SRR26913194_2 na het trimmen:**
![SRR26913194_1](`r getwd()`/Data/SRR26913194_2_Trimmomatic.png "Voor trimmen")

**Vergelijking van aantal reads verwijderd:**
Met de instellingen van de bovenstaande tabel is het volgende resultaat verkregen:
Het aantal reads voor het trimmen van SRR26913194 is 21866605, er na 19622278. Er zijn dus 2244327 reads weggehaald.
Volgens de formule C=LN/G. Coverage: (150×18248538)÷1000000 = 2943x

De minimale read lengte aangepast van 40 naar 70bp.
Het aantal reads voor het trimmen van SRR26913194 is 21866605, er na 18248538. Er zijn dus 3618067 reads weggehaald.
Coverage: (150×18248538)÷1000000 = 2737x

**Mappen met BWA**
SRR26913194 is gemapped met Human reference hg38.


## **Variant analyse: (IGV)**
Met behulp van IGV heb ik het gen AKT1 opgezocht. Op locatie chr14:104,772,547-104,773,181 zit een mutatie, heterozygoot voor dit allel.
Total count: 357. Volgens het referentiegenoom hoort er een thymine te zitten maar in het sample zit cytosine. 
Deze mutatie zit in een intron dus komt het niet in een eiwit tot expressie. 

Op locatie chr1:26,775,577-26,775,761 (chr1:26.775.671) zit een mutatie in een exon van gen: ARID1A. Ook heterozygoot en er zit een T waar een C hoort te zijn volgens het referentiegenoom. 

## **Variant analyse: (LoFreq)**

```{r data_frame}

df <- read.table(file='/home/floris/Documenten/Data_set/Medulloblastoma/medulloblastoma_gene_panel_V3_ucsc.bed.bed', header=FALSE)

names(df) <- c("Chromosome", "Start", "End", "Gene")

```
In de bovenstaande R chunk wordt een dataframe gemaakt op basis van het .bed bestand. Daarna krijgen de kolomen betere namen i.p.v. V1, V2, etc. 


```{r Aantal_exons_per_chromosoom}

chr_count <- (table(df$Chromosome))

exon_count <- df %>% 
  group_by(Chromosome) %>%
  summarise(n())

names(exon_count) <- c("Chromosome", "Count")
print(exon_count)

```


```{r}
library(ggplot2)

ggplot(data = exon_count, mapping = aes(x = Chromosome, y = Count)) +
  geom_bar(stat = "identity", fill="red", alpha=0.6) +
  coord_flip() +
  ylab(label = "Aantal exons") +
  xlab(label = "Chromosoom")
  theme_minimal()

```
Op het bovenstaande barplot staan de aantallen exons per chromosoom. 

```{r}
genes_per_chromosome <- table(unique(df$Gene, df$Chromosome))
genes_per_chromosome
```


**TODO:**
 3.1.2 Assignment 2; BED-visualization
 Visualize the number of genes per chromosome 
 
 Op de onderstaande chunk worden alle regels die het gen TSC2 bevatten geprint. 
 
```{r IRanges_Test}
#df[df$Gene == "TSC2", ]


TSC2 <- df[df$Gene == "TSC2", ]

# Assign whole columns to the IRanges arguments
ranges <- IRanges(start = TSC2$Start,
                  end = TSC2$End,
                  names = TSC2$Gene)

cat("Length of TSC2:", sum( width(ranges) ), "bp")
```

 Het IRanges object moet nu omgezet worden naar een GRanges object.
```{r GRanges_test}

# Converts iRanges to GRanges, adding the chromosome name
granges <- GRanges(seqnames = TSC2$Chromosome,
                   ranges = ranges)
granges

```

```{r GRanges_lijst}

genes = list()

#for (gen in df$Gene)
#  genes[gen] <- IRanges(start = gen$Start,
#                  end = gen$End,
#                  names = gen$Gene)


  
# Voor het aantal rows in het df:
genes <- lapply(seq_len(nrow(df)), function(i) {
    # Voer de volgende functie uit:
  IRanges(start = df$Start[i],
          end = df$End[i],
          names = df$Gene[i])})


# Voor het aantal rows in het df:
genes <- lapply(seq_len(nrow(df)), function(i) {
  # Voer de volgende functie uit:
  GRanges(seqnames = df$Chromosome[i], ranges = ranges)})




```
In de bovenstaande chunk wordt gebruik gemaakt van lappy of over het df te loopen en een functie uit te voeren voor elke rij. Eerst IRanges dan GRanges.



## **Data visualisatie:** 
